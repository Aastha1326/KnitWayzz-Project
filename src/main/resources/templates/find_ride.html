<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Find Rides - KnitWayzz</title>
    <style>
        body { background: #f0f2f5; font-family: 'Segoe UI', sans-serif;}
        .navbar {
            background: #ffe5d0;
            padding: 20px 0 12px 0;
            box-shadow: 0px 2px 8px rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: center;
        }
        .navbar .logo { font-size: 2rem; font-weight: bold; margin-right: 50px; letter-spacing: 1px; color: #fc8356; }
        .navbar nav a { text-decoration: none; color: #23423e; font-weight: 600; margin: 0 25px; font-size: 1.1rem; transition: color 0.2s;}
        .navbar nav a:hover { color: #fc8356;}
        .container {
            max-width: 670px;
            background: #fff;
            margin: 36px auto;
            padding: 30px 32px 28px 32px;
            border-radius: 18px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.10);
        }
        h1 { text-align: center; color: #23423e; font-size: 2.5rem; letter-spacing: 1px; margin-bottom: 18px;}
        .rides-section { margin-bottom: 38px; }
        .rides-section h2 { font-size: 1.35rem; color: #fc8356; margin-bottom: 18px;}
        .ride-list { display: flex; flex-direction: column; gap: 19px;}
        .ride-card {
            background: #fde8d6;
            border-radius: 15px;
            padding: 18px 20px 12px 18px;
            box-shadow: 0 2px 10px rgba(230,150,100,.07);
        }
        .ride-card h3 { color: #23423e; font-size: 1.15rem; margin-bottom:7px;}
        .ride-card p { margin-bottom: 6px; color: #333;}
        .ride-card span.status { font-weight: bold; font-size: 0.96rem; margin-top: 10px; display: inline-block; color: #fff; padding: 4px 18px; border-radius: 6px;}
        .status.active { background: #2ecc40;
        border:none;}
        .status.completed { background: #fc8356;}
        .status.pending { background: #ffbc42;}
        @media (max-width: 700px) {
            .container{padding: 4px;}
            .navbar .logo{font-size:1.2rem;}
            .navbar nav a{margin:0 12px;}
        }
    </style>
</head>
<body>
<!-- Navbar -->
<header class="navbar">
    <div class="logo">KnitWayzz</div>
    <nav>
        <a th:href="@{/}">Home</a>
        <a th:href="@{/post_ride}">Post a Ride</a>
        <a th:href="@{/my_rides}">My Rides</a>
    </nav>
</header>

<div class="container">
    <h1>Find Rides</h1>
    <!-- Search bar -->
    <form th:action="@{/find_ride}" method="get" style="display:flex; gap:10px; margin-bottom:18px; align-items:center;">
        <input type="text" name="source" placeholder="Search source"
               th:value="${sourceQuery}"
               style="flex:1; padding:10px 12px; border-radius:10px; border:1px solid #ddd;"/>
        <input type="text" name="destination" placeholder="Search destination"
               th:value="${destinationQuery}"
               style="flex:1; padding:10px 12px; border-radius:10px; border:1px solid #ddd;"/>
        <button type="submit"
                style="padding:10px 16px; font-weight:600; color:white; background:#23423e; border:none; border-radius:10px;">
            Search
        </button>
        <a th:href="@{/find_ride}"
           style="padding:10px 16px; font-weight:600; color:#23423e; background:#ffe5d0; border:none; border-radius:10px; text-decoration:none;">
            Reset
        </a>
    </form>

    <!-- Posted Rides -->
    <div class="rides-section posted-rides">
        <h2>Posted Rides</h2>
        <div class="ride-list">
            <div th:each="ride, iterStat : ${postedRides}" class="ride-card">
                <h3>From: <span th:text="${ride.source}"></span> ➡️ To: <span th:text="${ride.destination}"></span></h3>
                <p><strong>Date:</strong> <span th:text="${ride.date}"></span></p>
                <p><strong>Time From:</strong> <span th:text="${ride.timeFrom}"></span> | <strong>Time To:</strong> <span th:text="${ride.timeTo}"></span></p>
                <p><strong>Passengers:</strong> <span th:text="${ride.passengers}"></span></p>
                <p><strong>Vehicle:</strong> <span th:text="${ride.vehicle}"></span></p>

                <p><strong>Notes:</strong> <span th:text="${ride.notes}"></span></p>
                <p><strong>Max Contribution:</strong> ₹<span th:text="${ride.maxContribution}"></span></p>
                <span class="status active" >Active</span>
                <form th:action="@{/accept_ride/{id}(id=${ride.id})}" method="post" style="display:inline;">
                    <button type="submit" style=" font-family: 'Segoe UI', sans-serif; font-size:19px; font-weight:600; color:white; border:none; text-color:white; background: #2ecc40; border-radius:10%;">Accept</button>
                </form>

                <button class ="status active" type="button" th:attr="onclick='toggleInfo(' + ${iterStat.index} + ')'" style=" font-family: 'Segoe UI', sans-serif; font-size:19px; font-weight:600; color:white; border:none; text-color:white; background: #2ecc40; border-radius:10%;">View</button>

                <div th:attr="id='extraInfo' + ${iterStat.index}" style="display: none; margin-top:10px; background:#fff9ee; padding:12px; border-radius:7px;">
                    <p><strong>Mobile Number:</strong> <span th:text="${ride.mobileNo}"></span></p>
                </div>
            </div>

            <div th:if="${#lists.isEmpty(postedRides)}"><p>No posted rides yet.</p></div>
        </div>
    </div>
    <!-- Joined Rides -->
    <div class="rides-section joined-rides">
        <h2>Joined Rides</h2>
        <div class="ride-list">
            <div th:each="ride, iterStat : ${joinedRides}" class="ride-card">
                <h3>From: <span th:text="${ride.source}"></span> ➡️ To: <span th:text="${ride.destination}"></span></h3>
                <p><strong>Date:</strong> <span th:text="${ride.date}"></span></p>
                <p><strong>Time From:</strong> <span th:text="${ride.timeFrom}"></span> | <strong>Time To:</strong> <span th:text="${ride.timeTo}"></span></p>
                <p><strong>Passengers:</strong> <span th:text="${ride.passengers}"></span></p>
                <p><strong>Notes:</strong> <span th:text="${ride.notes}"></span></p>
                <p><strong>Max Contribution:</strong> ₹<span th:text="${ride.maxContribution}"></span></p>
                <span class="status completed">Joined</span>

                <!-- CANCEL BUTTON -->
                <form th:action="@{/cancel_ride/{id}(id=${ride.id})}" method="post" style="display:inline;">
                    <button type="submit" style="font-family:'Segoe UI',sans-serif; font-size:19px; font-weight:600; color:white; background:#fc8356; border:none; border-radius:10%;">Cancel</button>
                </form>
            </div>

            <div th:if="${#lists.isEmpty(joinedRides)}"><p>No joined rides yet.</p></div>
        </div>
    </div>
</div>
<script>
    function toggleInfo(idx) {
        var x = document.getElementById("extraInfo" + idx);
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }
</script>

</body>
</html>
