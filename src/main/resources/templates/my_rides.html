<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>My Rides - KnitWayzz</title>
    <style>
        body { background:#f0f2f5; font-family:'Segoe UI', sans-serif; margin:0; }
        .navbar {
          background:#ffe5d0; padding:20px 0 12px; box-shadow:0 2px 8px rgba(0,0,0,.05);
          display:flex; align-items:center; justify-content:center;
        }
        .navbar .logo { font-size:2rem; font-weight:700; margin-right:50px; letter-spacing:1px; color:#fc8356; }
        .navbar nav a {
          text-decoration:none; color:#23423e; font-weight:600; margin:0 25px; font-size:1.1rem; transition:color .2s;
        }
        .navbar nav a:hover { color:#fc8356; }

        .container {
          max-width: 700px; background:#fff; margin:36px auto; padding:28px 24px;
          border-radius:18px; box-shadow:0 4px 20px rgba(0,0,0,.10);
        }
        h1 { text-align:center; color:#23423e; font-size:2.2rem; letter-spacing:.5px; margin:0 0 18px; }
        .rides-section { margin-bottom: 30px; }
        .rides-section h2 { font-size:1.35rem; color:#fc8356; margin:0 0 16px; }

        .ride-list { display:flex; flex-direction:column; gap:22px; }
        .ride-card {
          background:#fde8d6; border-radius:15px; margin: 2px 0 4px; padding: 18px 20px 16px;;
          box-shadow:0 2px 10px rgba(230,150,100,.07);
        }
        .ride-card h3 { color:#23423e; font-size:1.1rem; margin:0 0 7px; }
        .ride-card p { margin:6px 0; color:#333; line-height:1.35; }

        .status { font-weight:700; font-size:.96rem; padding:4px 12px; border-radius:6px; color:#fff; background:#2e8b57; }
        .status.completed { background:#fc8356; }

        .actions { display:flex; gap:10px; flex-wrap:wrap; margin-top:8px; }
        .btn { padding:10px 16px; font-weight:600; border:none; border-radius:10px; cursor:pointer; }
        .btn-secondary { background:#23423e; color:#fff; }
        .btn-danger { background:#fc8356; color:#fff; }

        .extra {
          display:none; margin-top:10px; background:#fff9ee; padding:12px; border-radius:7px; border:1px solid #ffe5d0;
        }

        @media (max-width: 700px) {
          .container { padding: 12px; border-radius:14px; }
          .navbar .logo { font-size:1.4rem; margin-right:20px; }
          .navbar nav a { margin:0 10px; font-size:1rem; }
        }
    </style>
</head>
<body>
<header class="navbar">
    <div class="logo">KnitWayzz</div>
    <nav>
        <a th:href="@{/}">Home</a>
        <a th:href="@{/post_ride}">Post a Ride</a>
        <a th:href="@{/find_ride}">Find a Buddy</a>
    </nav>
</header>

<div class="container">
    <h1>My Rides</h1>

    <div class="rides-section my-rides">
        <h2>My Rides</h2>

        <div class="ride-list">

            <!-- Posted rides  -->
            <div th:if="${postedRides != null}">
                <div th:each="ride, iterStat : ${postedRides}" class="ride-card">
                    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
                        <h3>
                            From: <span th:text="${ride.source}"></span>
                            ➡️ To: <span th:text="${ride.destination}"></span>
                        </h3>
                        <span class="status">Posted</span>
                    </div>

                    <p><strong>Date:</strong> <span th:text="${ride.date}"></span></p>
                    <p><strong>Time From:</strong> <span th:text="${ride.timeFrom}"></span> |
                        <strong>Time To:</strong> <span th:text="${ride.timeTo}"></span></p>
                    <p><strong>Passengers:</strong> <span th:text="${ride.passengers}"></span></p>
                    <p><strong>Vehicle:</strong> <span th:text="${ride.vehicle}"></span></p>
                    <p><strong>Notes:</strong> <span th:text="${ride.notes}"></span></p>
                    <p><strong>Max Contribution:</strong> ₹<span th:text="${ride.maxContribution}"></span></p>

                    <div class="actions">
                        <!-- Delete posted ride (requires POST /delete_ride/{id}) -->
                        <form th:action="@{/delete_ride/{id}(id=${ride.id})}" method="post">
                            <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>

                        <!-- View toggle: safe data-target; JS picks up the target element -->
                        <button type="button"
                                th:with="eid=${'p' + iterStat.index}"
                                th:attr="data-target=${'extraInfo-' + eid}"
                                class="btn btn-secondary"
                                onclick="toggleInfo(this)">View</button>
                    </div>

                    <div class="extra"
                         th:with="eid=${'p' + iterStat.index}"
                         th:attr="id=${'extraInfo-' + eid}">
                        <p th:if="${ride.joinedBy != null and !#strings.isEmpty(ride.joinedBy)}">
                            <strong>Joined by:</strong>
                            <span th:text="${ride.joinedBy}"></span>
                        </p>
                        <p th:if="${ride.joinedBy == null or #strings.isEmpty(ride.joinedBy)}">
                            <strong>Joined by:</strong> No one joined yet
                        </p>
                    </div>
                </div>
            </div>

            <!-- Joined rides -->
            <div th:each="ride, iterStat : ${joinedRides}" class="ride-card">
                <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
                    <h3>
                        From: <span th:text="${ride.source}"></span>
                        ➡️ To: <span th:text="${ride.destination}"></span>
                    </h3>
                    <span class="status completed">Joined</span>
                </div>

                <p><strong>Date:</strong> <span th:text="${ride.date}"></span></p>
                <p><strong>Time From:</strong> <span th:text="${ride.timeFrom}"></span> |
                    <strong>Time To:</strong> <span th:text="${ride.timeTo}"></span></p>
                <p><strong>Passengers:</strong> <span th:text="${ride.passengers}"></span></p>
                <p><strong>Vehicle:</strong> <span th:text="${ride.vehicle}"></span></p>
                <p><strong>Notes:</strong> <span th:text="${ride.notes}"></span></p>
                <p><strong>Max Contribution:</strong> ₹<span th:text="${ride.maxContribution}"></span></p>

                <div class="actions">
                    <!-- Cancel joined ride -->
                    <form th:action="@{/myrides_cancel/{id}(id=${ride.id})}" method="post">
                        <input type="hidden" th:if="${_csrf != null}" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                        <button type="submit" class="btn btn-danger">Cancel</button>
                    </form>

                    <!-- View toggle -->
                    <button type="button"
                            th:with="eid=${'j' + iterStat.index}"
                            th:attr="data-target=${'extraInfo-' + eid}"
                            class="btn btn-secondary"
                            onclick="toggleInfo(this)">View</button>
                </div>

                <div class="extra"
                     th:with="eid=${'j' + iterStat.index}"
                     th:attr="id=${'extraInfo-' + eid}">
                    <p><strong>Mobile Number:</strong> <span th:text="${ride.mobileNo}"></span></p>
                </div>
            </div>

            <!-- Empty state -->
            <div th:if="${(postedRides == null || #lists.isEmpty(postedRides)) and #lists.isEmpty(joinedRides)}">
                <p>No rides yet.</p>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle the extra info panel by reading the data-target id from the clicked button
    function toggleInfo(btn) {
      var targetId = btn.getAttribute('data-target');
      var el = document.getElementById(targetId);
      if (!el) return;
      el.style.display = (el.style.display === 'none' || el.style.display === '') ? 'block' : 'none';
    }
</script>
</body>
</html>
